<!doctype html>
<html>
<head>
  <title>{$TITLE$}</title>
  <meta name="viewport" content="width={$CONTENT_WIDTH$}, initial-scale = 1.0" />
  <style>
    body {
      font: -apple-system-body;
      -webkit-overflow-scrolling: touch;
      font-weight: 300;
      letter-spacing: 1px;
      width: 100%;
      height: auto;
    }
    #page {
      margin: 12px;
      overflow-x: scroll;
    }
    a {
      color: #0081bd;
    }
    p {
      color: #444;
    }
    #title {
      font-size: 25px;
      font-weight: 400;
      margin-top: 5px;
      margin-bottom: 20px;
    }
    h2 {
      font-weight: 300;
    }
    h3, h4 {
      font-weight: 400;
    }
    iframe {
      border: none;
      width: 100% !important;
      margin: 0;
      padding-top: 0;
    }
    img {
      display: block;
      max-width: 100% !important;
      height: auto !important;
      margin: 0 auto 0 auto;
    }
  </style>
  <script>
    function onLoadAllImages(callback) {
      let done = callback
      let html = document.documentElement
      document.querySelectorAll('img').forEach(img => {
        if (!img.src) return img.parentNode.removeChild(img)
      })
      function checkIfImagesLoaded () {
        if ([].some.call(document.querySelectorAll('img'), img => !img.complete)) return
        done && done()
        done = null
        html.removeEventListener('load', checkIfImagesLoaded, true)
        html.removeEventListener('error', checkIfImagesLoaded, true)
      }
      html.addEventListener('load', checkIfImagesLoaded, true)
      html.addEventListener('error', checkIfImagesLoaded, true)
      checkIfImagesLoaded()
    }
  </script>
  <script defer src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
</head>
<body>
  <div id="page">
    {$TITLE$}
    {$PAGE_BODY$}
  </div>
  <script>
    // This script checks for data-api-endpoint attributes inside <a> tags.
    // If present, it replaces the href with the endpoint, with a few changes.
    //
    // The final href will look something like this:
    //
    //   x-canvas-discussion://canvas.instructure.com/api/v1/courses/12345/discussion_topics/54321
    //   x-canvas-folder-array://canvas.instructure.com/api/v1/folders/12345/folders
    //
    // The scheme name is composed as follows:
    //
    //   'x-canvas-' + <dataset.apiReturntype.toLowerCase()> [ + '-array' ]
    //
    // The rest of the URL is as in the data-api-endpoint attribute.
    document.querySelectorAll('a[data-api-endpoint]').forEach(link => {
      let endpoint = link.dataset.apiEndpoint
      let datatype = (link.dataset.apiReturntype || '').toLowerCase()
      if (datatype.startsWith('[') && datatype.endsWith(']')) {
        datatype = `${datatype.slice(1, -1)}-array`
      }

      if (endpoint && datatype) {
        let parts = endpoint.split('://')
        parts[0] = `x-canvas-${datatype}`
        link.href = parts.join('://')
      }
    })

    // handle math
    ;(() => {
      // WKWebView + MathJax mess up VoiceOver, but some LaTeX math might be gross without it :(
      //  so leave those as images for now, and don't load MathJax.
      // let foundMath = !!document.querySelector('math')
      document.querySelectorAll('img.equation_image').forEach(img => {
        if (!img.dataset.mathml/* && !img.dataset.equationContent*/) return
        // foundMath = true
        let div = document.createElement('div')
        div.innerHTML = img.dataset.mathml // || `$$${img.dataset.equationContent}$$`
        img.parentNode.replaceChild(div.firstChild, img)
      })
      // if (foundMath) {
      //   let script = document.createElement('script')
      //   script.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML'
      //   document.body.appendChild(script)
      // }
    })()
  </script>
</body>
</html>
