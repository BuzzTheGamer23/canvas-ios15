<html>
    <head>
        <title>{$TITLE$}</title>
        <style>
            {$CSS}
        </style>
        <script type="text/javascript">
            {$javascript}
        </script>
        <meta name="viewport" content="width=device-width;" />
    </head>
    <body>
        <div class="discussion_entry" id="entry">
            <div class="discussion_content">{$ENTRY$}</div>
            <ul class="attachment_links">{$ATTACHMENTS$}</ul>
        </div>
    </body>
    
    <script type="text/javascript">
        function resizeToWidth(width) {
            var meta = document.getElementsByTag('meta')[0];
            meta.content = "width="+width+"px";
        }
        
        onLoadAllImages(function () {
            // Inform the DiscussionEntryCell that all the images are loaded
            var iframe = document.createElement("iframe");
            iframe.setAttribute("src", "discussionCell://finishedLoadingImages/");
            document.documentElement.appendChild(iframe);
            iframe.parentNode.removeChild(iframe);
            iframe = null;
        });
    </script>

    <script type="text/javascript">
        document.querySelectorAll('iframe').forEach(iframe => {
            const replace = iframe => {
                const a = document.createElement('a')
                a.textContent = '{$LTI_LAUNCH_TEXT$}'
                a.classList.add('canvas-ios-lti-launch-button')
                a.href = iframe.src
                iframe.parentNode.replaceChild(a, iframe)
            }
            if (/\/courses\/\d+\/external_tools\/retrieve/.test(iframe.src)) {
                replace(iframe)
            } else {
                iframe.addEventListener('error', event => replace(event.target))
            }
        })
    </script>
</html>
